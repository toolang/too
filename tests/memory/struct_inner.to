
import fmt
import os
import net

mem data {
	i8 a,b,c,d
}
// 1.结构体嵌套
mem innerDirect{
	i8    a
	data  inner
}
// 2.内嵌结构体指针
mem innerPointer{
	i8     a
	data*  inner
}
func test_inner_direct(){
	fmt.println("test_direct")
	var<innerDirect> = new innerDirect
	var2<data> = var.inner
	var2.a = 10
	var2.b = 20
	var2.c = 30
	var2.d = 40
	// 内嵌结构体字段的访问：引用与无引用都是读取的地址
	p<data> = &var.inner
	if  p.a != 10 || p.b != 20 || p.c != 30 || p.d != 40 {
		fmt.println("test inner1 failed")
		os.exit(-1)
	}
	// 测试下 引用访问和非引用访问
	if  var.inner != &var.inner {
		fmt.println("mem  field: & access and direct access  should equal")
		os.exit(-1)
	}
	fmt.println("test_direct success")
}

func test_inner_pointer(){
	fmt.println("test_pointer")
	var<innerPointer> = new innerPointer
	var2<data> = new data
	var.inner = var2
	if  var.inner != var2 {
		fmt.println("var.inner != var2 ")
		os.exit(-1)
	}
	var2.a = 10
	var2.b = 20
	var2.c = 30
	var2.d = 40
	p<data> = var.inner
	if  p.a != 10 || p.b != 20 || p.c != 30 || p.d != 40 {
		fmt.println("test pointer failed")
		os.exit(-1)
	}
	// 测试下 引用访问和非引用访问
	if  var.inner == &var.inner {
		fmt.println("mem pointer field: & access and direct access not should equal")
		os.exit(-1)
	}
	fmt.println("test_pointer success")
}



func main(){
	test_inner_direct()
	test_inner_pointer()
	test_extern_direct()
	test_extern_pointer()
}

// 3.结构体嵌套
mem externDirect{
	i8    	  a
	net.data  inner
}
// 4.内嵌结构体指针
mem externPointer{
	i8     a
	net.data*  inner
}
func test_extern_direct(){
	fmt.println("test_extern_direct")
	var<externDirect> = new externDirect
	var2<net.data> = var.inner
	var2.a = 10
	var2.b = 20
	var2.c = 30
	var2.d = 40
	// 内嵌结构体字段的访问：引用与无引用都是读取的地址
	p<net.data> = &var.inner
	if  p.a != 10 || p.b != 20 || p.c != 30 || p.d != 40 {
		fmt.println("test inner1 failed")
		os.exit(-1)
	}
	// 测试下 引用访问和非引用访问
	if  var.inner != &var.inner {
		fmt.println("mem  field: & access and direct access  should equal")
		os.exit(-1)
	}
	fmt.println("test_extern_direct success")
}
func test_extern_pointer(){
	fmt.println("test_extern_pointer")
	var<externPointer> = new externPointer
	var2<net.data> = new net.data
	var.inner = var2
	if  var.inner != var2 {
		fmt.println("var.inner != var2 ")
		os.exit(-1)
	}
	var2.a = 10
	var2.b = 20
	var2.c = 30
	var2.d = 40
	p<net.data> = var.inner
	if  p.a != 10 || p.b != 20 || p.c != 30 || p.d != 40 {
		fmt.println("test pointer failed")
		os.exit(-1)
	}
	// 测试下 引用访问和非引用访问
	if  var.inner == &var.inner {
		fmt.println("mem pointer field: & access and direct access not should equal")
		os.exit(-1)
	}
	fmt.println("test_extern_pointer success")
}